{% extends 'admin/base.html.twig' %}

{% block title %}Tableau de bord administrateur{% endblock %}

{% block body_class %}admin-dashboard{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
    .dashboard-card {
        transition: transform 0.2s;
    }
    .dashboard-card:hover {
        transform: translateY(-5px);
    }
    .stat-card {
        border: none;
        border-radius: 10px;
    }
    .stat-icon {
        font-size: 2.5rem;
        opacity: 0.8;
    }
    .list-group-item {
        border-left: none;
        border-right: none;
    }
    .list-group-item:first-child {
        border-top: none;
    }
    .list-group-item:last-child {
        border-bottom: none;
    }
    .content-wrapper {
        margin-left: 150px;
        padding-right: 50px;
        min-height: 100vh;
        background-color: #f8f9fa;
    }
    .sidebar {
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        overflow-y: auto;
    }
    .sidebar .nav-link {
        padding: 0.8rem 1.5rem;
        color: #fff;
        opacity: 0.8;
        transition: all 0.3s;
    }
    .sidebar .nav-link:hover {
        opacity: 1;
        background-color: rgba(255,255,255,0.1);
    }
    .sidebar .nav-link.active {
        opacity: 1;
        background-color: #0d6efd;
    }
    body {
        overflow-x: hidden;
    }
</style>
{% endblock %}

{% block body %}
    {# Sidebar #}
    {% include 'admin/_sidebar.html.twig' %}

    {# Main content #}
    <div class="content-wrapper">
        <div class="container-fluid p-4">
            <div class="d-flex justify-content-end align-items-center mb-4">
                <div class="btn-group">
                    <button type="button" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-calendar3"></i> {{ "now"|date('d/m/Y') }}
                    </button>
                </div>
            </div>

            {# Zone de contenu dynamique #}
            <div id="dynamic-content">
                {# Statistics Cards #}
                <div id="dashboard-stats" class="row g-4 mb-4 justify-content-center">
                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="card stat-card bg-primary text-white h-100 dashboard-card text-center cursor-pointer" data-page="/admin/users">
                            <div class="card-body">
                                <div class="d-flex flex-column align-items-center">
                                    <div class="stat-icon mb-3">
                                        <i class="bi bi-people"></i>
                                    </div>
                                    <div>
                                        <h6 class="card-title mb-0">Utilisateurs</h6>
                                        <h2 class="mt-3 mb-0">{{ totalUsers }}</h2>
                                        <p class="small mb-0">Inscrits sur la plateforme</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card stat-card bg-success text-white h-100 dashboard-card text-center">
                        <div class="card-body">
                            <div class="d-flex flex-column align-items-center">
                                <div class="stat-icon mb-3">
                                    <i class="bi bi-file-text"></i>
                                </div>
                                <div>
                                    <h6 class="card-title mb-0">Articles</h6>
                                    <h2 class="mt-3 mb-0">{{ totalArticles }}</h2>
                                    <p class="small mb-0">Articles publiés</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card stat-card bg-info text-white h-100 dashboard-card text-center">
                        <div class="card-body">
                            <div class="d-flex flex-column align-items-center">
                                <div class="stat-icon mb-3">
                                    <i class="bi bi-chat-dots"></i>
                                </div>
                                <div>
                                    <h6 class="card-title mb-0">Commentaires</h6>
                                    <h2 class="mt-3 mb-0">{{ totalComments }}</h2>
                                    <p class="small mb-0">Commentaires postés</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card stat-card bg-warning h-100 dashboard-card text-center">
                        <div class="card-body">
                            <div class="d-flex flex-column align-items-center">
                                <div class="stat-icon mb-3">
                                    <i class="bi bi-tags"></i>
                                </div>
                                <div>
                                    <h6 class="card-title mb-0">Catégories</h6>
                                    <h2 class="mt-3 mb-0">{{ totalCategories }}</h2>
                                    <p class="small mb-0">Catégories créées</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {# Recent Activity Section supprimée #}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animation pour les cartes de statistiques
    const cards = document.querySelectorAll('.dashboard-card');
    const dynamicContent = document.getElementById('dynamic-content');
    const dashboardStats = document.getElementById('dashboard-stats');
    let currentView = 'dashboard';

    // Gestion des animations au survol
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });

        // Gestion du clic sur les cartes
        card.addEventListener('click', function() {
            const pageUrl = this.dataset.page;
            if (pageUrl) {
                loadContent(pageUrl);
            }
        });
    });

    // Gestion des clics sur les liens du menu
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            if (href && href.startsWith('/admin/')) {
                e.preventDefault();
                loadContent(href);
            } else if (href === '#' || href === '') {
                e.preventDefault();
                showDashboard();
            }
        });
    });

    // Fonction pour charger le contenu dynamiquement
    function loadContent(url) {
        fetch(url)
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const mainContent = doc.querySelector('main') || doc.querySelector('.container-fluid');
                if (mainContent) {
                    dashboardStats.style.display = 'none';
                    const contentWrapper = document.createElement('div');
                    contentWrapper.className = 'dynamic-page-content';
                    contentWrapper.innerHTML = mainContent.innerHTML;
                    
                    // Remplacer le contenu existant ou ajouter le nouveau
                    const existingContent = dynamicContent.querySelector('.dynamic-page-content');
                    if (existingContent) {
                        existingContent.replaceWith(contentWrapper);
                    } else {
                        dynamicContent.appendChild(contentWrapper);
                    }
                    
                    currentView = 'page';
                }
            })
            .catch(error => {
                console.error('Erreur lors du chargement du contenu:', error);
            });
    }

    // Fonction pour revenir au tableau de bord
    function showDashboard() {
        if (currentView !== 'dashboard') {
            const pageContent = dynamicContent.querySelector('.dynamic-page-content');
            if (pageContent) {
                pageContent.remove();
            }
            dashboardStats.style.display = 'flex';
            currentView = 'dashboard';
        }
    }

    // Ajouter la classe cursor-pointer aux cartes
    cards.forEach(card => {
        card.classList.add('cursor-pointer');
    });
});
</script>
<style>
    .cursor-pointer {
        cursor: pointer;
    }
    .dynamic-page-content {
        animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>
{% endblock %}